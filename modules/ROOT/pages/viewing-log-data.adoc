= ログデータの表示
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

CloudHub は各ワーカーのデプロイメントのメッセージとイベントを含むログデータへのアクセスを提供します。

[NOTE]
====
ログと診断は、現在 CloudHub ワーカーにデプロイされたアプリケーションのみで使用可能です。アプリケーションがローカルサーバにデプロイされている場合、外部の分析ソフトウェアにデータを送信できます。

Pivotal Cloud Foundry (PCF) にデプロイされたアプリケーションでは、Runtime Manager を介してログデータは公開されませんが、Pivotal の UI でイベントログを参照できます。
====


== ログの表示

CloudHub にデプロイされたアプリケーションのログを表示します。

. Runtime Manager の左側のメニューで *[Applications (アプリケーション)]* をクリックし、CloudHub にデプロイされるアプリケーションをクリックして、右側の管理パネルを開きます。
. ​*[Logs (ログ)]*​をクリックします。
+
アプリケーションログが表示されます。
. ログ画面の右側の *[Deployments (デプロイメント)]* セクションで、日付、デプロイメント、システムログ、ワーカー別の出力を選択して参照できます。日付の横のチェックボックスをオフにして検索条件の適用を解除できます。
+
image::elmfilters.png[ELMfilters]

== ログのダウンロード

各 CloudHub デプロイメントのワーカーごとにダウンロード可能なログがあります。

. 右側の *[Deployments (デプロイメント)]* 検索条件セクションで、表示する日付とワーカーを検索します。
. ワーカーの横のダウンロードアイコンをクリックして、*[Logs (ログ)]* を選択します。

image::downloadlogs.png[DownloadLogs]

ログファイルは、`.log` ファイル拡張子を使用するテキストファイルで、`<deployment-ID>-<instance-ID>.log` 形式になります。ログファイルはテキストエディタを使用して表示できます。

[NOTE]
CloudHub のアプリケーションログを、監査、分析、または同様の目的で定期的にアーカイブまたはダウンロードする必要がある場合は、xref:custom-log-appender.adoc[カスタムログアペンダ]を使用してログを抽出します。


== 診断のダウンロード

診断には、各デプロイメントの各 CloudHub ワーカーの Java スレッドダンプが表示されます。これらはサーバの現在の状態を示し、デバッグとサポートに役立ちます。

[NOTE]
3.8.0 より前の Mule バージョン (バージョン 3.7.4 を除く) で実行されるアプリケーションでは診断は利用できません。


. 右側の *[Deployments (デプロイメント)]* 検索条件セクションで、診断をダウンロードする日付とワーカーを選択します。
. 横にあるダウンロードアイコンをクリックして、*[Diagnostics (診断)]* を選択します。

ダウンロードされるログファイルは、`.txt` ファイル拡張子を使用するテキストファイルで、`<app-name>-instance-<instance-ID>-<worker-number>-diag.txt` 形式の名前が付けられます。このファイルはテキストエディタを使用して表示できます。


[TIP]
====
診断では、ワーカーのインスタンス ID はデプロイメント ID とワーカー番号 (0 ～ 4) の組み合わせになります。

次の URL を使用して診断ファイルを直接ダウンロードすることもできます。

`api/v2/applications/appName/instances/instanceId/diagnostics`
====


== ログの永続性について

CloudHub では、ログは、ワーカーごとにアプリケーションあたり最大 100 MB または最長 30 日間のいずれかの制限に達するまで保存されます。

== ログのタイムゾーンについて

CloudHub では、ログデータは協定世界時 (UTC) で保存されますが、コンソールにはコンピュータのローカルタイムゾーンを使用してログが表示されます。


== 検索ログ

特定の値を含むログを検索したり、高度な検索を使用して日付や優先度でログを検索したりできます。

. 検索ボックスに値を入力するか、または ​*[Advanced (詳細)]*​をクリックして、時刻、日付、日付範囲、およびメッセージ優先度を指定してログを検索します。
. *[Apply (適用)]* をクリックします。
+
image::elmadvancedsearch.png[ELMAdvancedSearch]

=== 日時による検索

*[Date & Time (日時)]* 検索条件では、日付範囲を指定してログを検索できます。可能な値:

* *Last hour (過去 1 時間)*
* *Last 24 hours (過去 24 時間)*
* *Last week (先週)*
* *Last month (先月)*

=== メッセージの優先度による検索

*[Priority (優先度)]* 検索条件では、ログの特定のイベントを表示できます。表の​*コマンド*​列に示すように、検索ボックスに`priority<type>`を入力してさまざまな優先度を指定することもできます。

可能な値:

[%header,cols="3*a"]
|===
| 値
| 説明
| コマンド

| すべての優先度
| すべてのメッセージをリストします。
| なし

| `ERROR`
| 例外が発生した場合のエラーメッセージのみをリストします。
| priority:ERROR

| `FATAL`
| アプリケーションが失敗した場合の致命的なメッセージのみをリストします。
| priority:FATAL

| `INFO`
| 有益情報のメッセージをリストします。
| priority:INFO

| `SYSTEM`
| アプリケーションとワーカーのスタートアップに関するメッセージをリストします。
| priority:SYSTEM

| `CONSOLE`
| オブジェクトストアの設定など、コンソールイベントに関するメッセージをリストします。
| priority:CONSOLE

| `WARN`
| 警告メッセージをリストします。
| priority:WARN

| `DEBUG`
| デバッグメッセージをリストします。
| priority:DEBUG

|===

=== ワイルドカード検索

ログページ上部の検索ボックスに、ログメッセージの結果と照合する検索語を入力して、ログデータを絞り込むことができます。また、ワイルドカード検索の一般的な量指定子を使用して、ログメッセージ内の正確な語を検索することもできます。

* `?` - 疑問符は 0 または 1 個の先行要素に一致します。
* `&#8727;` - アスタリスクは 0 または 1 個の先行要素に一致します。

== 関連情報

* xref:deployment-strategies.adoc[デプロイメント戦略]
* xref:sending-data-from-arm-to-external-analytics-software.adoc[外部分析ツールへのデータのエクスポート]
* xref:monitoring.adoc[アプリケーションの監視]
* xref:mule-runtime::logging-in-mule.adoc[ログの設定]
