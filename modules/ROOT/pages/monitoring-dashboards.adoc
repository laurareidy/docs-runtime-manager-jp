= Runtime Manager の監視ダッシュボード
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]


監視ダッシュボードには、デプロイされたアプリケーションとデプロイ先のシステムの両方の使用量メトリクスの詳細が表示されます。ダッシュボードにより、アプリケーションとサーバのメトリクスの推移を表示できます。 

== アプリケーション監視ダッシュボード

アプリケーション監視ダッシュボードは、統合されたアプリケーションに関する次のような質問に答えるのに役立ちます。

* 使用量のピークが発生したのいつか?
* 高トラフィックのピークが応答時間に与える影響は?
* アプリケーションの背後の処理能力はこれらの高トラフィックのピークに適切に対処できているか?
* 高トラフィックのピークがメッセージの失敗率に与える影響は?
* 同じサーバで実行されている他のアプリケーションの高トラフィックのピークが、特定のアプリケーションのパフォーマンスに与える影響は?

=== 必要な権限

ダッシュボードを表示するには、Runtime Manager の​*「Read Application (アプリケーションの参照)」*​権限または Runtime Manager の​*「Read Servers (サーバの参照)」*​権限が必要です。

=== 組み込み Anypoint Monitoring ダッシュボード (CloudHub)

Anypoint Monitoring ダッシュボードは、クラシックアプリケーション監視ダッシュボードよりも多くの監視メトリクスを提供し、いろいろな種類のグラフを表示する複数のページがあります。 

組み込み Anypoint Monitoring ダッシュボードは、Mule 3.8.7-AM または 3.9.0 以降で実行されていて Anypoint Monitoring が有効な CloudHub アプリケーションで表示されます。xref:monitoring::configure-monitoring-cloudhub.adoc[「Mule アプリケーションの Anypoint Monitoring の設定と有効化 (CloudHub)」]を参照してください。

Anypoint Monitoring ダッシュボードの詳細については、Anypoint Monitoring ドキュメントのxref:monitoring::app-dashboards.adoc[「組み込みアプリケーションダッシュボード」]を参照してください。

=== クラシックアプリケーション監視ダッシュボード

クラシックアプリケーション監視ダッシュボードは、Mule メッセージ、CPU、およびメモリのメトリクスを表示します。

クラシックアプリケーション監視ダッシュボードは以下で表示されます。 

* 3.8.7 より前の Mule バージョンで動作している CloudHub アプリケーション
* オンプレミスでデプロイされているアプリケーション (ハイブリッド)
* Runtime Fabric にデプロイされているアプリケーション

== アプリケーション監視ダッシュボードにアクセスする

. Runtime Manager の左側のメニューで、*[Applications (アプリケーション)]* をクリックします。 
. アプリケーションのリストで、監視するアプリケーションの名前をクリックします。 +
選択したアプリケーションの監視ダッシュボードが開きます。表示されるダッシュボードは、選択したアプリケーションのバージョンと種別によって異なります。 

選択したアプリケーションが以下の場合には xref:monitoring::app-dashboards.adoc[Anypoint Monitoring] ダッシュボードが表示されます。 

* CloudHub にデプロイされている
* Mule 3.8.7-AM または 3.9.0 以降で実行されている
* アプリケーションで Anypoint Monitoring が有効化されている

[NOTE]
ハイブリッドアプリケーションでは、監視が有効で、過去 24 時間に渡って監視された CPU メトリクスが存在する場合にダッシュボードが表示されます。

*[Switch back to classic metrics (クラシックメトリクスに切り替える)]* リンクをクリックすると、クラシックアプリケーション監視ダッシュボードが表示されます。ページの一番上にある青のバナーをクリックすると、Anypoint Monitoring ダッシュボードに戻ります。

選択したアプリケーションが以下の場合には、クラシックアプリケーション監視ダッシュボードが表示されます。

* CloudHub にデプロイされている
* 3.8.7 より前の Mule バージョンで実行されている
* オンプレミスでデプロイされている
* Runtime Fabric にデプロイされている
* 監視が有効化されていない

== アプリケーションメトリクスの表示

異なる時間範囲のすべてのグラフを表示するには、ページの一番上から時間間隔を選択します。

アプリケーションが同時に複数のワーカーで実行される場合は、異なる色で区別した曲線として、同じグラフ上に表示されます。

アプリケーションがクラスタまたはサーバグループで実行されている場合、サーバグループまたはクラスタに含まれるサーバセット全体の集計メトリクスが 1 本の折れ線として表示されます。

[TIP]
アプリケーションをクラスタまたはサーバグループで実行し、メトリクスを個々のサーバレベルで表示するには、個々のサーバのダッシュボードを参照してください。サーバで複数のアプリケーションが実行中の場合、表示されるのはサーバの総合的なパフォーマンスで、実行中のアプリケーションごとに区別されません。

== アラート

アプリケーションとサーバのxref:alerts-on-runtime-manager.adoc#conditions-on-locally-deployed-applications[アラート]を設定し、いずれかのメトリクスが長時間にわたって重大値を示すと自動的に通知されるようにします。

== サーバの監視ダッシュボードにアクセスする

[NOTE]
Anypoint Platform Private Cloud Edition では監視ダッシュボード機能がサポートされていません。

. Runtime Manager の左側のメニューで、*[Servers (サーバ)]* をクリックします。 
. サーバの行をクリックして、ページの右側で管理パネルを開きます。
. *[View Dashboard (ダッシュボードを表示)]* ボタンをクリックします。 +
サーバのダッシュボードが表示されます。

image::monitoring-dashboards-server.png[]

サーバを含むクラスタまたはサーバグループのダッシュボードを最初に開き、サーバの名前をクリックすることで、サーバのダッシュボードに移動することもできます。

== サーバメトリクスの表示

サーバの監視ダッシュボードにはいくつかのメトリクスが表示され、2 つのペインに分かれています。

* *Overview (概要)*: サーバのメモリと CPU の使用量を概要レベルで表示します。
* *Breakdown (詳細分析)*: サーバメモリの各部を別々に追跡する詳細なメトリクスを表示します。

特定の期間のグラフを表示するには、ページの右上で時間間隔を選択します。

image::monitoring-dashboards-cbd92.png[]

グラフの任意の点にカーソルを置くと、その時点のアクティビティに関する数値の詳細がフロート表示されます。

image::monitoring-dashboards-hover.png[]


サーバで複数のアプリケーションが実行されている場合、リストからアプリケーションを選択することで、別々のグラフセットにそれらのパフォーマンスを表示できます。アプリケーションを選択すると、右側のサイドパネルに次のデータが表示されます。

=== Server Metrics (サーバメトリクス)

このサーバのダッシュボードのグラフには、メモリと CPU の使用量に関連するさまざまなメトリクスが表示されます。*[Overview (概要)]* タブでこれらのメトリクスを概要レベルで参照するか、*[Breakdown (詳細分析)]* を表示して、メモリの各部分を個別に追跡する詳細な一連のメトリクスを参照できます。

このダッシュボードのグラフは、*[Overview (概要)]* と *[Breakdown (詳細分析)]* の両方のタブでメモリ使用量レベルを表示し、次の値を追跡します。

* *Used (使用)* - 現在使用中のメモリの量 (MB 単位)。 
Java VM が使用メモリを増量してコミット済みメモリよりも大きくしようとすると、使用量が合計未満であっても、メモリの割り当てが失敗する場合があります。
* *Committed (コミット済み)* - Java VM で使用できるメモリの量 (MB 単位)。この量は時間と共に変動します。コミット済みメモリの量は、常に使用メモリの量以上になります。
* *Total (合計)* - サーバが使用できるメモリの最大量 (MB 単位)。最大量は変動するか、または未定義の場合があります。 

=== JVM Heap Memory (JVM ヒープメモリ)

ヒープとは、すべての Java オブジェクトが保存されている領域です。ヒープは JVM のスタートアップ時に作成され、そこに含まれているアプリケーションを中断せずにサイズを拡大または縮小することができます。ヒープが満杯になると、<<garbage_collection,ガベージコレクションが実行され>>、もう使用しないオブジェクトが消去されて新しいオブジェクト用のスペースが確保されます。

非ヒープメモリには、ランタイム定数プール、項目およびメソッドデータ、メソッドおよびコンストラクタのコードなど、クラスごとの構造が保存されます。

*[Overview (概要)]* タブにあるこのメトリクスは、合計ヒープメモリ使用量 (MB 単位) です。各構成要素の詳細は、​<<Breakdown (詳細分析) タブ,​Breakdown (詳細分析) タブ>>​を参照してください。

image::monitoring-dashboards-heap.png[]

* ヒープメモリの使用量
* コミット済みヒープメモリ
* メモリ合計

=== CPU

*[Overview (概要)]* タブにあるこのメトリクスは、サーバの合計 CPU 使用量であり、割合で表されます。

image::monitoring-dashboards-cpu.png[]

* CPU 使用量
* システムの利用可能な処理能力
* システムの負荷平均

+
[NOTE]
Windows ではこのメトリクスは使用できません。

=== Thread Count (スレッド数)

このグラフには、個々のスレッドの数が経時的に表示されます。

image::monitoring-dashboards-threads.png[]

ここでのスレッドは、Java の実行スレッドを指します。JVM では、アプリケーションで複数の実行スレッドを同時に実行できます。

[[garbage_collection]]
=== ガベージコレクション

JVM では、2 つのフェーズから成る、ガベージコレクションのマークアンドスイープ方式アルゴリズムが実装されます。

* 第 1 フェーズ: マークフェーズであり、ガベージコレクションアルゴリズムがアクセス可能なオブジェクトをすべて見つけてマークを付けます。 
* 第 2 フェーズ: スイープフェーズであり、ガベージコレクションアルゴリズムがヒープをスキャンし、マークされていないオブジェクトをすべて解放します。 

image::monitoring-dashboards-garbage.png[]

=== Class Loading (クラスローディング)

Class Loading (クラスローディング) グラフには、JVM にあるすべてのアプリケーションを合計した、現在ロード済みまたはロード中のクラスの量が表示されます。

image::monitoring-dashboards-classloading.png[]

=== ヒープメモリのメトリクス

次のメトリクスは、JVM ヒープを構成するサーバメモリ部分に関連します。

==== Par Eden / Eden Space (Par Eden / Eden 領域)

ほとんどのオブジェクトに最初に割り当てられるメモリが含まれているヒープ領域内のプール。

image::monitoring-dashboards-eden.png[]

==== Par Survivor / Survivor Space (Par Survivor / Survivor 領域)

Eden 領域のガベージコレクションを耐え抜いたオブジェクトが含まれているヒープ内のプール。

image::monitoring-dashboards-survivor.png[]

==== Tenured Generation (Tenured 世代)

Survivor 領域内にしばらく存在したオブジェクトが含まれているヒープ内のプール。

image::monitoring-dashboards-tenure.png[]

=== 非ヒープメモリのメトリクス

次のメトリクスは、JVM ヒープの外側に存在するメモリを指します。

==== Code Cache (コードキャッシュ)

この非ヒープ領域には、ネイティブコードのコンパイルと保存に使用されるメモリが含まれています。

image::monitoring-dashboards-cahce.png[]

==== Compressed Class Space (圧縮クラス領域)

[NOTE]
このメトリクスは、JDK 8+ を使用する場合にのみ使用できます。

image::monitoring-dashboards-class-space.png[]

==== Metaspace

クラスのメタデータの表現にネイティブメモリが使用される JVM のメモリ領域。
このメトリクスは、JDK 8+ を使用する場合にのみ使用できます。

image::monitoring-dashboards-meta.png[]

== サーバグループダッシュボードとクラスタダッシュボード

=== サーバグループダッシュボードまたはクラスタダッシュボードにアクセスする

オンプレミスのクラスタまたはサーバグループのダッシュボードにアクセスする手順は、次のとおりです。

. *[Servers (サーバ)]* ページでサーバを選択し、サイドパネルを開きます。
. *[View Dashboard (ダッシュボードを表示)]* ボタンをクリックします。 +
サーバグループまたはクラスタのダッシュボードが表示されます。 

=== ダッシュボードの操作

ダッシュボードには、3 つのメトリクスが表示されます。

* CPU usage (CPU 使用量) (最大量に対する割合)
* Memory usage (メモリ使用量) (MB 単位)
* Heap total (ヒープ合計) (MB 単位)

image::monitoring-dashboards-5cd3c.png[]

右上隅にある目的の期間を選択することで、異なる時間単位でグラフを表示できます。

image::monitoring-dashboards-cbd92.png[]

含まれているサーバセット全体でメトリクスが集約され、1 本の折れ線としてメインのグラフセットに表示されます。

この情報を、個々のサーバかアプリケーションのいずれかで分析でき、視点を選択できる 2 つのタブがあります。

image::monitoring-dashboards-6fe9f.png[]

次に、1 つまたは複数のサーバかアプリケーションを選択すると、右側のサイドパネルにこのデータが表示されます。

また、このメニューから個々のサーバ名をクリックして、<<サーバのダッシュボード,そのサーバの>>ダッシュボードに移動することもできます。

[TIP]
xref:alerts-on-runtime-manager.adoc#conditions-on-mule-servers[アラート]をセットアップし、いずれかのメトリクスが長時間にわたって重大値を示すと自動的に通知されるようにします。

== インサイト

失敗の根本原因を分析したり、パフォーマンスのボトルネックを特定したり、会社の手続きに準拠しているかどうかをテストしたりするには、xref:insight.adoc[インサイト]を使用します。


== 関連情報

* xref:monitoring::app-dashboards.adoc[組み込みアプリケーションダッシュボード]
* xref:insight.adoc[インサイト]
* xref:managing-deployed-applications.adoc[デプロイ済みアプリケーションの管理]
* xref:managing-applications-on-cloudhub.adoc[CloudHub でのアプリケーションの管理]
* xref:deploying-to-cloudhub.adoc[CloudHub へのデプロイ]
* xref:cloudhub.adoc[CloudHub] 
* xref:monitoring.adoc[アプリケーションの監視]
* xref:cloudhub-fabric.adoc[CloudHub Fabric]
* xref:anypoint-platform-cli.adoc[コマンドラインツール]
